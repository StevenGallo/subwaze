<!DOCTYPE html>
<html>
<head>

  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/materialize/0.98.0/css/materialize.min.css">
<link rel='stylesheet' href='/stylesheets/style.css' />
</head>
<!--   <% include partials/head.ejs %> -->
  <body>


    <% include partials/header.ejs %>


    <% if (user !== 'not logged in') { %>
        <a href="/user/"><span>Profile</span></a> |
    <% } %>
    <a href="/trains"><span>View All Trains</span></a>

    <div class="container">
        <div class="section center-align">
        <!-- <h1 class="center-align"><%= trains.line %> Train</h1> -->
            <div class="row">
                <a class="btn-floating btn-large waves-effect waves-light <%= trains.color %>"><i class="material-icons"><%= trains.line %></i></a>
            </div>
        </div>

        <div class="train_status" style="width:200px; font-size:30px; color:green;">
            On Time
        </div>

        <% if (user !== 'not logged in') { %>
<!--              <% if (favs.indexOf(trains.id) === -1) { %> -->

             <form class="favForm" id="favForm" onsubmit="printFav(event);" action="<%= '/user/' + '/favorites/' + trains.id + '?_method=POST' %>" method="POST">
                <input type="submit" id="addFavButton" value="Follow This Train" />
            </form>

<!--             <% } %> -->
        <% } %>

        <p id="favConfirm" class="center"></p>

        <% comments.reverse().forEach((comment) => { %>
            <div class="comment_list" style="width: 700px; border:5px solid black">
                <div class="comment">
                    <span class="time"><%= comment.createdAt %></span>
                    <p>
                        <%= comment.comment %>
                    </p>
                  <div class="user_name"><%= comment.firstName %></div> <br />
                  <span class="likes">Likes : <%= comment.likes %></span>
                  <span class="dislike">Dislikes: <%= comment.dislikes%></span>
              </div>
          </div>
        <% }) %>
    </div>

        <button onclick="showComments()">Add comment</button>

        <form id="addComment" class="hidden" action="/user/trains/<%= trains.id %>/comment" method="POST">
            <input type="text" name="comment" />
            <input type="submit" value="Post" />
        </form>

        <p id="mustLogin" class="center"></p>





      <script
      src="https://code.jquery.com/jquery-3.1.1.min.js"
      integrity="sha256-hVVnYaiADRTO2PzUGmuLJr8BLUSjGIZsDYGmIJLv2b8="
      crossorigin="anonymous"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/0.98.0/js/materialize.min.js"></script>

        <script>
            function showComments () {
                if('<%= user %>' === 'not logged in') {
                  // had to pass user different values, on both the index route and user route, to have button perform different functions.
                    document.getElementById('mustLogin').innerHTML='Must be logged in to add comment';
                } else if ('<%= user %>' !== 'not logged in') {
                   document.getElementById('addComment').classList.toggle('show');
                }
            }
            function printFav (event) {
                // event.preventDefault();
                document.getElementById('favConfirm').innerHTML='Added to favorites';
                document.getElementById('favForm').classList.add('hidden');
            }
        </script>

  </body>
</html>
